<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Loki: SmallObj.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1>SmallObj.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">// The Loki Library</span>
<a name="l00003"></a>00003 <span class="comment">// Copyright (c) 2001 by Andrei Alexandrescu</span>
<a name="l00004"></a>00004 <span class="comment">// This code accompanies the book:</span>
<a name="l00005"></a>00005 <span class="comment">// Alexandrescu, Andrei. "Modern C++ Design: Generic Programming and Design </span>
<a name="l00006"></a>00006 <span class="comment">//     Patterns Applied". Copyright (c) 2001. Addison-Wesley.</span>
<a name="l00007"></a>00007 <span class="comment">// Permission to use, copy, modify, distribute and sell this software for any </span>
<a name="l00008"></a>00008 <span class="comment">//     purpose is hereby granted without fee, provided that the above copyright </span>
<a name="l00009"></a>00009 <span class="comment">//     notice appear in all copies and that both that copyright notice and this </span>
<a name="l00010"></a>00010 <span class="comment">//     permission notice appear in supporting documentation.</span>
<a name="l00011"></a>00011 <span class="comment">// The author or Addison-Wesley Longman make no representations about the </span>
<a name="l00012"></a>00012 <span class="comment">//     suitability of this software for any purpose. It is provided "as is" </span>
<a name="l00013"></a>00013 <span class="comment">//     without express or implied warranty.</span>
<a name="l00015"></a>00015 <span class="comment"></span><span class="preprocessor">#ifndef LOKI_SMALLOBJ_INC_</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#define LOKI_SMALLOBJ_INC_</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span>
<a name="l00018"></a>00018 <span class="comment">// $Id: SmallObj.h 806 2007-02-03 00:01:52Z rich_sposato $</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <span class="preprocessor">#include "LokiExport.h"</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "Threads.h"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "Singleton.h"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;cstddef&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;new&gt;</span> <span class="comment">// needed for std::nothrow_t parameter.</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#ifndef LOKI_DEFAULT_CHUNK_SIZE</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#define LOKI_DEFAULT_CHUNK_SIZE 4096</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span>
<a name="l00031"></a>00031 <span class="preprocessor">#ifndef LOKI_MAX_SMALL_OBJECT_SIZE</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#define LOKI_MAX_SMALL_OBJECT_SIZE 256</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035 <span class="preprocessor">#ifndef LOKI_DEFAULT_OBJECT_ALIGNMENT</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#define LOKI_DEFAULT_OBJECT_ALIGNMENT 4</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a>00039 <span class="preprocessor">#ifndef LOKI_DEFAULT_SMALLOBJ_LIFETIME</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="preprocessor">#define LOKI_DEFAULT_SMALLOBJ_LIFETIME ::Loki::LongevityLifetime::DieAsSmallObjectParent</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a>00043 <span class="preprocessor">#if defined(LOKI_SMALL_OBJECT_USE_NEW_ARRAY) &amp;&amp; defined(_MSC_VER)</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#pragma message("Don't define LOKI_SMALL_OBJECT_USE_NEW_ARRAY when using a Microsoft compiler to prevent memory leaks.")</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#pragma message("now calling '#undef LOKI_SMALL_OBJECT_USE_NEW_ARRAY'")</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor">#undef LOKI_SMALL_OBJECT_USE_NEW_ARRAY</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="keyword">namespace </span>Loki
<a name="l00055"></a>00055 {
<a name="l00056"></a>00056     <span class="keyword">namespace </span>LongevityLifetime
<a name="l00057"></a>00057     {
<a name="l00064"></a>00064         <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00065"></a><a class="code" href="a00079.html">00065</a>         <span class="keyword">struct </span><a class="code" href="a00079.html">DieAsSmallObjectParent</a>  : <a class="code" href="a00082.html">DieLast</a>&lt;T&gt; {};
<a name="l00066"></a>00066 
<a name="l00073"></a>00073         <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00074"></a><a class="code" href="a00078.html">00074</a>         <span class="keyword">struct </span><a class="code" href="a00078.html">DieAsSmallObjectChild</a>  : <a class="code" href="a00080.html">DieDirectlyBeforeLast</a>&lt;T&gt; {};
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     } 
<a name="l00077"></a>00077 
<a name="l00078"></a>00078     <span class="keyword">class </span><a class="code" href="a00133.html">FixedAllocator</a>;
<a name="l00079"></a>00079 
<a name="l00086"></a><a class="code" href="a00524.html">00086</a>     <span class="keyword">class </span>LOKI_EXPORT SmallObjAllocator
<a name="l00087"></a>00087     {
<a name="l00088"></a>00088     <span class="keyword">protected</span>:
<a name="l00095"></a>00095         SmallObjAllocator( std::size_t pageSize, std::size_t maxObjectSize,
<a name="l00096"></a>00096             std::size_t objectAlignSize );
<a name="l00097"></a>00097 
<a name="l00103"></a>00103         ~SmallObjAllocator( <span class="keywordtype">void</span> );
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     <span class="keyword">public</span>:
<a name="l00135"></a>00135         <span class="keywordtype">void</span> * Allocate( std::size_t size, <span class="keywordtype">bool</span> doThrow );
<a name="l00136"></a>00136 
<a name="l00141"></a>00141         <span class="keywordtype">void</span> Deallocate( <span class="keywordtype">void</span> * p, std::size_t size );
<a name="l00142"></a>00142 
<a name="l00150"></a>00150         <span class="keywordtype">void</span> Deallocate( <span class="keywordtype">void</span> * p );
<a name="l00151"></a>00151 
<a name="l00153"></a><a class="code" href="a00524.html#2d8f61afdfa600b9aacf7178aa167d93">00153</a>         <span class="keyword">inline</span> std::size_t GetMaxObjectSize()<span class="keyword"> const</span>
<a name="l00154"></a>00154 <span class="keyword">        </span>{ <span class="keywordflow">return</span> maxSmallObjectSize_; }
<a name="l00155"></a>00155 
<a name="l00157"></a><a class="code" href="a00524.html#2af86d8e6bdfe16047d2e586ec34b3b7">00157</a>         <span class="keyword">inline</span> std::size_t GetAlignment()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> objectAlignSize_; }
<a name="l00158"></a>00158 
<a name="l00166"></a>00166         <span class="keywordtype">bool</span> TrimExcessMemory( <span class="keywordtype">void</span> );
<a name="l00167"></a>00167 
<a name="l00176"></a>00176         <span class="keywordtype">bool</span> IsCorrupt( <span class="keywordtype">void</span> ) <span class="keyword">const</span>;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     <span class="keyword">private</span>:
<a name="l00180"></a>00180         SmallObjAllocator( <span class="keywordtype">void</span> );
<a name="l00182"></a>00182         SmallObjAllocator( <span class="keyword">const</span> SmallObjAllocator &amp; );
<a name="l00184"></a>00184         SmallObjAllocator &amp; operator = ( <span class="keyword">const</span> SmallObjAllocator &amp; );
<a name="l00185"></a>00185 
<a name="l00187"></a>00187         <a class="code" href="a00133.html">Loki::FixedAllocator</a> * pool_;
<a name="l00188"></a>00188 
<a name="l00190"></a>00190         <span class="keyword">const</span> std::size_t maxSmallObjectSize_;
<a name="l00191"></a>00191 
<a name="l00193"></a>00193         <span class="keyword">const</span> std::size_t objectAlignSize_;
<a name="l00194"></a>00194     };
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 
<a name="l00213"></a>00213     <span class="keyword">template</span>
<a name="l00214"></a>00214     &lt;
<a name="l00215"></a>00215         <span class="keyword">template</span> &lt;<span class="keyword">class</span>, <span class="keyword">class</span>&gt; <span class="keyword">class </span>ThreadingModel = LOKI_DEFAULT_THREADING_NO_OBJ_LEVEL,
<a name="l00216"></a>00216         std::size_t chunkSize = LOKI_DEFAULT_CHUNK_SIZE,
<a name="l00217"></a>00217         std::size_t maxSmallObjectSize = LOKI_MAX_SMALL_OBJECT_SIZE,
<a name="l00218"></a>00218         std::size_t objectAlignSize = LOKI_DEFAULT_OBJECT_ALIGNMENT,
<a name="l00219"></a>00219         <span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; <span class="keyword">class </span>LifetimePolicy = LOKI_DEFAULT_SMALLOBJ_LIFETIME,
<a name="l00220"></a>00220         <span class="keyword">class </span>MutexPolicy = LOKI_DEFAULT_MUTEX
<a name="l00221"></a>00221     &gt;
<a name="l00222"></a><a class="code" href="a00013.html">00222</a>     <span class="keyword">class </span><a class="code" href="a00013.html">AllocatorSingleton</a> : <span class="keyword">public</span> SmallObjAllocator
<a name="l00223"></a>00223     {
<a name="l00224"></a>00224     <span class="keyword">public</span>:
<a name="l00225"></a>00225 
<a name="l00227"></a>00227         <span class="keyword">typedef</span> <a class="code" href="a00013.html">AllocatorSingleton</a>&lt; ThreadingModel, chunkSize,
<a name="l00228"></a><a class="code" href="a00013.html#47fa2a9f8348fc8ce749221f7bfa7245">00228</a>             maxSmallObjectSize, objectAlignSize, LifetimePolicy &gt; <a class="code" href="a00013.html">MyAllocator</a>;
<a name="l00229"></a>00229 
<a name="l00231"></a><a class="code" href="a00013.html#c9fde708e2ee0bf990c3eaa34422ca25">00231</a>         <span class="keyword">typedef</span> ThreadingModel&lt; MyAllocator, MutexPolicy &gt; <a class="code" href="a00013.html#c9fde708e2ee0bf990c3eaa34422ca25">MyThreadingModel</a>;
<a name="l00232"></a>00232 
<a name="l00234"></a>00234         <span class="keyword">typedef</span> <a class="code" href="a00521.html">Loki::SingletonHolder</a>&lt; <a class="code" href="a00013.html">MyAllocator</a>, <a class="code" href="a00056.html">Loki::CreateStatic</a>,
<a name="l00235"></a><a class="code" href="a00013.html#74b23f8327ce4f3d795aa20240deb99e">00235</a>             LifetimePolicy, ThreadingModel &gt; <a class="code" href="a00521.html">MyAllocatorSingleton</a>;
<a name="l00236"></a>00236 
<a name="l00238"></a><a class="code" href="a00013.html#0de7839b1e888e11ff44bc50b78ca7d7">00238</a>         <span class="keyword">inline</span> <span class="keyword">static</span> <a class="code" href="a00013.html">AllocatorSingleton</a> &amp; <a class="code" href="a00013.html#0de7839b1e888e11ff44bc50b78ca7d7">Instance</a>( <span class="keywordtype">void</span> )
<a name="l00239"></a>00239         {
<a name="l00240"></a>00240             <span class="keywordflow">return</span> <a class="code" href="a00521.html#43e4ea5cb6291a8bb14eb7cdc2bcb7bf">MyAllocatorSingleton::Instance</a>();
<a name="l00241"></a>00241         }
<a name="l00242"></a>00242 
<a name="l00244"></a><a class="code" href="a00013.html#c1ce92a825643f114d555fea170e2a99">00244</a>         <span class="keyword">inline</span> <a class="code" href="a00013.html#c1ce92a825643f114d555fea170e2a99">AllocatorSingleton</a>() :
<a name="l00245"></a>00245             SmallObjAllocator( chunkSize, maxSmallObjectSize, objectAlignSize )
<a name="l00246"></a>00246             {}
<a name="l00247"></a>00247 
<a name="l00249"></a><a class="code" href="a00013.html#f4248c104f7c04f4dbef16543083be53">00249</a>         <span class="keyword">inline</span> <a class="code" href="a00013.html#f4248c104f7c04f4dbef16543083be53">~AllocatorSingleton</a>( <span class="keywordtype">void</span> ) {}
<a name="l00250"></a>00250 
<a name="l00259"></a>00259         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="a00013.html#082b4ba1c6574c5bed916c55ecf46e82">ClearExtraMemory</a>( <span class="keywordtype">void</span> );
<a name="l00260"></a>00260 
<a name="l00269"></a>00269         <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="a00013.html#033978d127f16d2da0fd79d31ee75713">IsCorrupted</a>( <span class="keywordtype">void</span> );
<a name="l00270"></a>00270 
<a name="l00271"></a>00271     <span class="keyword">private</span>:
<a name="l00273"></a>00273         <a class="code" href="a00013.html#c1ce92a825643f114d555fea170e2a99">AllocatorSingleton</a>( <span class="keyword">const</span> <a class="code" href="a00013.html">AllocatorSingleton</a> &amp; );
<a name="l00275"></a>00275         <a class="code" href="a00013.html">AllocatorSingleton</a> &amp; operator = ( <span class="keyword">const</span> <a class="code" href="a00013.html">AllocatorSingleton</a> &amp; );
<a name="l00276"></a>00276     };
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     <span class="keyword">template</span>
<a name="l00279"></a>00279     &lt;
<a name="l00280"></a>00280         <span class="keyword">template</span> &lt;<span class="keyword">class</span>, <span class="keyword">class</span>&gt; <span class="keyword">class </span>T,
<a name="l00281"></a>00281         std::size_t C,
<a name="l00282"></a>00282         std::size_t M,
<a name="l00283"></a>00283         std::size_t O,
<a name="l00284"></a>00284         <span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; <span class="keyword">class </span>L,
<a name="l00285"></a>00285         <span class="keyword">class </span>X
<a name="l00286"></a>00286     &gt;
<a name="l00287"></a><a class="code" href="a00013.html#082b4ba1c6574c5bed916c55ecf46e82">00287</a>     <span class="keywordtype">void</span> <a class="code" href="a00013.html">AllocatorSingleton&lt; T, C, M, O, L, X &gt;::ClearExtraMemory</a>( <span class="keywordtype">void</span> )
<a name="l00288"></a>00288     {
<a name="l00289"></a>00289         <span class="keyword">typename</span> MyThreadingModel::Lock lock;
<a name="l00290"></a>00290         (void)lock; <span class="comment">// get rid of warning</span>
<a name="l00291"></a>00291         <a class="code" href="a00013.html#0de7839b1e888e11ff44bc50b78ca7d7">Instance</a>().<a class="code" href="a00524.html#6b635664b20a6984303dabde86c8ac83">TrimExcessMemory</a>();
<a name="l00292"></a>00292     }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="keyword">template</span>
<a name="l00295"></a>00295     &lt;
<a name="l00296"></a>00296         <span class="keyword">template</span> &lt;<span class="keyword">class</span>, <span class="keyword">class</span>&gt; <span class="keyword">class </span>T,
<a name="l00297"></a>00297         std::size_t C,
<a name="l00298"></a>00298         std::size_t M,
<a name="l00299"></a>00299         std::size_t O,
<a name="l00300"></a>00300         <span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; <span class="keyword">class </span>L,
<a name="l00301"></a>00301         <span class="keyword">class </span>X
<a name="l00302"></a>00302     &gt;
<a name="l00303"></a><a class="code" href="a00013.html#033978d127f16d2da0fd79d31ee75713">00303</a>     <span class="keywordtype">bool</span> <a class="code" href="a00013.html">AllocatorSingleton&lt; T, C, M, O, L, X &gt;::IsCorrupted</a>( <span class="keywordtype">void</span> )
<a name="l00304"></a>00304     {
<a name="l00305"></a>00305         <span class="keyword">typename</span> MyThreadingModel::Lock lock;
<a name="l00306"></a>00306         (void)lock; <span class="comment">// get rid of warning</span>
<a name="l00307"></a>00307         <span class="keywordflow">return</span> <a class="code" href="a00013.html#0de7839b1e888e11ff44bc50b78ca7d7">Instance</a>().<a class="code" href="a00524.html#3199a817e272e76400cc7fc4d2d117a7">IsCorrupt</a>();
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309 
<a name="l00322"></a>00322     <span class="keyword">template</span>
<a name="l00323"></a>00323     &lt;
<a name="l00324"></a>00324         <span class="keyword">template</span> &lt;<span class="keyword">class</span>, <span class="keyword">class</span>&gt; <span class="keyword">class </span>T,
<a name="l00325"></a>00325         std::size_t C,
<a name="l00326"></a>00326         std::size_t M,
<a name="l00327"></a>00327         std::size_t O,
<a name="l00328"></a>00328         <span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; <span class="keyword">class </span>L,
<a name="l00329"></a>00329         <span class="keyword">class </span>X
<a name="l00330"></a>00330     &gt;
<a name="l00331"></a><a class="code" href="a00608.html#bd6a1e278e749117c26908963320b02e">00331</a>     <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="a00608.html#bd6a1e278e749117c26908963320b02e">GetLongevity</a>(
<a name="l00332"></a>00332         <a class="code" href="a00013.html">AllocatorSingleton&lt; T, C, M, O, L, X &gt;</a> * )
<a name="l00333"></a>00333     {
<a name="l00334"></a>00334         <span class="comment">// Returns highest possible value.</span>
<a name="l00335"></a>00335         <span class="keywordflow">return</span> 0xFFFFFFFF;
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 
<a name="l00427"></a>00427     <span class="keyword">template</span>
<a name="l00428"></a>00428     &lt;
<a name="l00429"></a>00429         <span class="keyword">template</span> &lt;<span class="keyword">class</span>, <span class="keyword">class</span>&gt; <span class="keyword">class </span>ThreadingModel,
<a name="l00430"></a>00430         std::size_t chunkSize,
<a name="l00431"></a>00431         std::size_t maxSmallObjectSize,
<a name="l00432"></a>00432         std::size_t objectAlignSize,
<a name="l00433"></a>00433         <span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; <span class="keyword">class </span>LifetimePolicy,
<a name="l00434"></a>00434         <span class="keyword">class </span>MutexPolicy
<a name="l00435"></a>00435     &gt;
<a name="l00436"></a><a class="code" href="a00526.html">00436</a>     <span class="keyword">class </span><a class="code" href="a00526.html">SmallObjectBase</a>
<a name="l00437"></a>00437     {
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 <span class="preprocessor">#if (LOKI_MAX_SMALL_OBJECT_SIZE != 0) &amp;&amp; (LOKI_DEFAULT_CHUNK_SIZE != 0) &amp;&amp; (LOKI_DEFAULT_OBJECT_ALIGNMENT != 0)</span>
<a name="l00440"></a>00440 <span class="preprocessor"></span>
<a name="l00441"></a>00441     <span class="keyword">public</span>:        
<a name="l00444"></a>00444         <span class="keyword">typedef</span> <a class="code" href="a00013.html">AllocatorSingleton</a>&lt; ThreadingModel, chunkSize,
<a name="l00445"></a><a class="code" href="a00526.html#d07df1c9ec9c41580e07e32eddcda82d">00445</a>             maxSmallObjectSize, objectAlignSize, LifetimePolicy &gt; <a class="code" href="a00013.html">ObjAllocatorSingleton</a>;
<a name="l00446"></a>00446     
<a name="l00447"></a>00447     <span class="keyword">private</span>:
<a name="l00448"></a>00448 
<a name="l00450"></a>00450         <span class="keyword">typedef</span> ThreadingModel&lt; ObjAllocatorSingleton, MutexPolicy &gt; MyThreadingModel;
<a name="l00451"></a>00451 
<a name="l00453"></a>00453         <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="a00521.html">ObjAllocatorSingleton::MyAllocatorSingleton</a> <a class="code" href="a00521.html">MyAllocatorSingleton</a>;
<a name="l00454"></a>00454         
<a name="l00455"></a>00455     <span class="keyword">public</span>:
<a name="l00456"></a>00456 
<a name="l00458"></a>00458 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00460"></a>00460 <span class="preprocessor">        static void * operator new ( std::size_t size )</span>
<a name="l00461"></a>00461 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00462"></a><a class="code" href="a00526.html#39f9c8d5b17c09bece34c8a400981970">00462</a> <span class="preprocessor"></span>        <span class="keyword">static</span> <span class="keywordtype">void</span> * <a class="code" href="a00526.html#39f9c8d5b17c09bece34c8a400981970">operator new </a>( std::size_t size ) <span class="keywordflow">throw</span> ( std::bad_alloc )
<a name="l00463"></a>00463 <span class="preprocessor">#endif</span>
<a name="l00464"></a>00464 <span class="preprocessor"></span>        {
<a name="l00465"></a>00465             <span class="keyword">typename</span> MyThreadingModel::Lock lock;
<a name="l00466"></a>00466             (void)lock; <span class="comment">// get rid of warning</span>
<a name="l00467"></a>00467             <span class="keywordflow">return</span> <a class="code" href="a00521.html#43e4ea5cb6291a8bb14eb7cdc2bcb7bf">MyAllocatorSingleton::Instance</a>().Allocate( size, <span class="keyword">true</span> );
<a name="l00468"></a>00468         }
<a name="l00469"></a>00469 
<a name="l00471"></a><a class="code" href="a00526.html#d212efa68b48292bf8fd2dd158b49400">00471</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> * <a class="code" href="a00526.html#39f9c8d5b17c09bece34c8a400981970">operator new </a>( std::size_t size, <span class="keyword">const</span> std::nothrow_t &amp; ) throw ()
<a name="l00472"></a>00472         {
<a name="l00473"></a>00473             <span class="keyword">typename</span> MyThreadingModel::Lock lock;
<a name="l00474"></a>00474             (void)lock; <span class="comment">// get rid of warning</span>
<a name="l00475"></a>00475             <span class="keywordflow">return</span> <a class="code" href="a00521.html#43e4ea5cb6291a8bb14eb7cdc2bcb7bf">MyAllocatorSingleton::Instance</a>().Allocate( size, <span class="keyword">false</span> );
<a name="l00476"></a>00476         }
<a name="l00477"></a>00477 
<a name="l00479"></a><a class="code" href="a00526.html#dbbe1bde0960a38502af0940004d942f">00479</a>         <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> * <a class="code" href="a00526.html#39f9c8d5b17c09bece34c8a400981970">operator new </a>( std::size_t size, <span class="keywordtype">void</span> * place )
<a name="l00480"></a>00480         {
<a name="l00481"></a>00481             return ::operator new( size, place );
<a name="l00482"></a>00482         }
<a name="l00483"></a>00483 
<a name="l00485"></a><a class="code" href="a00526.html#698e8b9ebac9df8c03e557c842a59bc5">00485</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="a00526.html#698e8b9ebac9df8c03e557c842a59bc5">operator delete </a>( <span class="keywordtype">void</span> * p, std::size_t size ) <span class="keywordflow">throw</span> ()
<a name="l00486"></a>00486         {
<a name="l00487"></a>00487             <span class="keyword">typename</span> MyThreadingModel::Lock lock;
<a name="l00488"></a>00488             (void)lock; <span class="comment">// get rid of warning</span>
<a name="l00489"></a>00489             <a class="code" href="a00521.html#43e4ea5cb6291a8bb14eb7cdc2bcb7bf">MyAllocatorSingleton::Instance</a>().Deallocate( p, size );
<a name="l00490"></a>00490         }
<a name="l00491"></a>00491 
<a name="l00495"></a><a class="code" href="a00526.html#b835d84fa8bc1ed3a558dc2e7a7e39ec">00495</a>         <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="a00526.html#698e8b9ebac9df8c03e557c842a59bc5">operator delete </a>( <span class="keywordtype">void</span> * p, <span class="keyword">const</span> std::nothrow_t &amp; ) throw()
<a name="l00496"></a>00496         {
<a name="l00497"></a>00497             <span class="keyword">typename</span> MyThreadingModel::Lock lock;
<a name="l00498"></a>00498             (void)lock; <span class="comment">// get rid of warning</span>
<a name="l00499"></a>00499             <a class="code" href="a00521.html#43e4ea5cb6291a8bb14eb7cdc2bcb7bf">MyAllocatorSingleton::Instance</a>().Deallocate( p );
<a name="l00500"></a>00500         }
<a name="l00501"></a>00501 
<a name="l00503"></a><a class="code" href="a00526.html#e2da17da13c6c6a0d7e33c9df9eb27f2">00503</a>         <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="a00526.html#698e8b9ebac9df8c03e557c842a59bc5">operator delete </a>( <span class="keywordtype">void</span> * p, <span class="keywordtype">void</span> * place )
<a name="l00504"></a>00504         {
<a name="l00505"></a>00505             ::operator <span class="keyword">delete</span> ( p, place );
<a name="l00506"></a>00506         }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508 <span class="preprocessor">#ifdef LOKI_SMALL_OBJECT_USE_NEW_ARRAY</span>
<a name="l00509"></a>00509 <span class="preprocessor"></span>
<a name="l00511"></a>00511 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00513"></a>00513 <span class="preprocessor">        static void * operator new [] ( std::size_t size )</span>
<a name="l00514"></a>00514 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00515"></a>00515 <span class="preprocessor"></span>        <span class="keyword">static</span> <span class="keywordtype">void</span> * operator new [] ( std::size_t size )
<a name="l00516"></a>00516             <span class="keywordflow">throw</span> ( std::bad_alloc )
<a name="l00517"></a>00517 <span class="preprocessor">#endif</span>
<a name="l00518"></a>00518 <span class="preprocessor"></span>        {
<a name="l00519"></a>00519             <span class="keyword">typename</span> MyThreadingModel::Lock lock;
<a name="l00520"></a>00520             (void)lock; <span class="comment">// get rid of warning</span>
<a name="l00521"></a>00521             <span class="keywordflow">return</span> <a class="code" href="a00521.html#43e4ea5cb6291a8bb14eb7cdc2bcb7bf">MyAllocatorSingleton::Instance</a>().Allocate( size, <span class="keyword">true</span> );
<a name="l00522"></a>00522         }
<a name="l00523"></a>00523 
<a name="l00525"></a>00525         <span class="keyword">static</span> <span class="keywordtype">void</span> * operator new [] ( std::size_t size,
<a name="l00526"></a>00526             <span class="keyword">const</span> std::nothrow_t &amp; ) throw ()
<a name="l00527"></a>00527         {
<a name="l00528"></a>00528             <span class="keyword">typename</span> MyThreadingModel::Lock lock;
<a name="l00529"></a>00529             (void)lock; <span class="comment">// get rid of warning</span>
<a name="l00530"></a>00530             <span class="keywordflow">return</span> <a class="code" href="a00521.html#43e4ea5cb6291a8bb14eb7cdc2bcb7bf">MyAllocatorSingleton::Instance</a>().Allocate( size, <span class="keyword">false</span> );
<a name="l00531"></a>00531         }
<a name="l00532"></a>00532 
<a name="l00534"></a>00534         <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> * operator new [] ( std::size_t size, <span class="keywordtype">void</span> * place )
<a name="l00535"></a>00535         {
<a name="l00536"></a>00536             return ::operator new( size, place );
<a name="l00537"></a>00537         }
<a name="l00538"></a>00538 
<a name="l00540"></a>00540         <span class="keyword">static</span> <span class="keywordtype">void</span> operator delete [] ( <span class="keywordtype">void</span> * p, std::size_t size ) <span class="keywordflow">throw</span> ()
<a name="l00541"></a>00541         {
<a name="l00542"></a>00542             <span class="keyword">typename</span> MyThreadingModel::Lock lock;
<a name="l00543"></a>00543             (void)lock; <span class="comment">// get rid of warning</span>
<a name="l00544"></a>00544             <a class="code" href="a00521.html#43e4ea5cb6291a8bb14eb7cdc2bcb7bf">MyAllocatorSingleton::Instance</a>().Deallocate( p, size );
<a name="l00545"></a>00545         }
<a name="l00546"></a>00546 
<a name="l00550"></a>00550         <span class="keyword">static</span> <span class="keywordtype">void</span> operator delete [] ( <span class="keywordtype">void</span> * p,
<a name="l00551"></a>00551             <span class="keyword">const</span> std::nothrow_t &amp; ) throw()
<a name="l00552"></a>00552         {
<a name="l00553"></a>00553             <span class="keyword">typename</span> MyThreadingModel::Lock lock;
<a name="l00554"></a>00554             (void)lock; <span class="comment">// get rid of warning</span>
<a name="l00555"></a>00555             <a class="code" href="a00521.html#43e4ea5cb6291a8bb14eb7cdc2bcb7bf">MyAllocatorSingleton::Instance</a>().Deallocate( p );
<a name="l00556"></a>00556         }
<a name="l00557"></a>00557 
<a name="l00559"></a>00559         <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> operator delete [] ( <span class="keywordtype">void</span> * p, <span class="keywordtype">void</span> * place )
<a name="l00560"></a>00560         {
<a name="l00561"></a>00561             ::operator <span class="keyword">delete</span> ( p, place );
<a name="l00562"></a>00562         }
<a name="l00563"></a>00563 <span class="preprocessor">#endif  // #if use new array functions.</span>
<a name="l00564"></a>00564 <span class="preprocessor"></span>
<a name="l00565"></a>00565 <span class="preprocessor">#endif  // #if default template parameters are not zero</span>
<a name="l00566"></a>00566 <span class="preprocessor"></span>
<a name="l00567"></a>00567     <span class="keyword">protected</span>:
<a name="l00568"></a><a class="code" href="a00526.html#134032479f32bf1cca4af50caf51858a">00568</a>         <span class="keyword">inline</span> <a class="code" href="a00526.html#134032479f32bf1cca4af50caf51858a">SmallObjectBase</a>( <span class="keywordtype">void</span> ) {}
<a name="l00569"></a><a class="code" href="a00526.html#d1c3a013df6cd2d95908003e006e1515">00569</a>         <span class="keyword">inline</span> <a class="code" href="a00526.html#134032479f32bf1cca4af50caf51858a">SmallObjectBase</a>( <span class="keyword">const</span> <a class="code" href="a00526.html">SmallObjectBase</a> &amp; ) {}
<a name="l00570"></a><a class="code" href="a00526.html#6e872e4f97b5572c294dc0162cbcccf6">00570</a>         <span class="keyword">inline</span> <a class="code" href="a00526.html">SmallObjectBase</a> &amp; <a class="code" href="a00526.html#6e872e4f97b5572c294dc0162cbcccf6">operator = </a>( <span class="keyword">const</span> <a class="code" href="a00526.html">SmallObjectBase</a> &amp; )
<a name="l00571"></a>00571         { <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00572"></a><a class="code" href="a00526.html#0cda1fae67845425caf5fc84a07c0701">00572</a>         <span class="keyword">inline</span> <a class="code" href="a00526.html#0cda1fae67845425caf5fc84a07c0701">~SmallObjectBase</a>() {}
<a name="l00573"></a>00573     }; <span class="comment">// end class SmallObjectBase</span>
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 
<a name="l00585"></a>00585     <span class="keyword">template</span>
<a name="l00586"></a>00586     &lt;
<a name="l00587"></a>00587         <span class="keyword">template</span> &lt;<span class="keyword">class</span>, <span class="keyword">class</span>&gt; <span class="keyword">class </span>ThreadingModel = LOKI_DEFAULT_THREADING_NO_OBJ_LEVEL,
<a name="l00588"></a>00588         std::size_t chunkSize = LOKI_DEFAULT_CHUNK_SIZE,
<a name="l00589"></a>00589         std::size_t maxSmallObjectSize = LOKI_MAX_SMALL_OBJECT_SIZE,
<a name="l00590"></a>00590         std::size_t objectAlignSize = LOKI_DEFAULT_OBJECT_ALIGNMENT,
<a name="l00591"></a>00591         <span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; <span class="keyword">class </span>LifetimePolicy = LOKI_DEFAULT_SMALLOBJ_LIFETIME,
<a name="l00592"></a>00592         <span class="keyword">class </span>MutexPolicy = LOKI_DEFAULT_MUTEX
<a name="l00593"></a>00593     &gt;
<a name="l00594"></a><a class="code" href="a00525.html">00594</a>     <span class="keyword">class </span><a class="code" href="a00525.html">SmallObject</a> : <span class="keyword">public</span> <a class="code" href="a00526.html">SmallObjectBase</a>&lt; ThreadingModel, chunkSize,
<a name="l00595"></a>00595             maxSmallObjectSize, objectAlignSize, LifetimePolicy, MutexPolicy &gt;
<a name="l00596"></a>00596     {
<a name="l00597"></a>00597 
<a name="l00598"></a>00598     <span class="keyword">public</span>:
<a name="l00599"></a><a class="code" href="a00525.html#4b58ab3dd1b4ff59bf3cbb14685ea406">00599</a>         <span class="keyword">virtual</span> <a class="code" href="a00525.html#4b58ab3dd1b4ff59bf3cbb14685ea406">~SmallObject</a>() {}
<a name="l00600"></a>00600     <span class="keyword">protected</span>:
<a name="l00601"></a><a class="code" href="a00525.html#4441795df1cbf565159e7d6a665fd403">00601</a>         <span class="keyword">inline</span> <a class="code" href="a00525.html#4441795df1cbf565159e7d6a665fd403">SmallObject</a>( <span class="keywordtype">void</span> ) {}
<a name="l00602"></a>00602 
<a name="l00603"></a>00603     <span class="keyword">private</span>:
<a name="l00605"></a>00605         <a class="code" href="a00525.html#4441795df1cbf565159e7d6a665fd403">SmallObject</a>( <span class="keyword">const</span> <a class="code" href="a00525.html">SmallObject</a> &amp; );
<a name="l00607"></a>00607         <a class="code" href="a00525.html">SmallObject</a> &amp; operator = ( <span class="keyword">const</span> <a class="code" href="a00525.html">SmallObject</a> &amp; );
<a name="l00608"></a>00608     }; <span class="comment">// end class SmallObject</span>
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 
<a name="l00621"></a>00621     <span class="keyword">template</span>
<a name="l00622"></a>00622     &lt;
<a name="l00623"></a>00623         <span class="keyword">template</span> &lt;<span class="keyword">class</span>, <span class="keyword">class</span>&gt; <span class="keyword">class </span>ThreadingModel = LOKI_DEFAULT_THREADING_NO_OBJ_LEVEL,
<a name="l00624"></a>00624         std::size_t chunkSize = LOKI_DEFAULT_CHUNK_SIZE,
<a name="l00625"></a>00625         std::size_t maxSmallObjectSize = LOKI_MAX_SMALL_OBJECT_SIZE,
<a name="l00626"></a>00626         std::size_t objectAlignSize = LOKI_DEFAULT_OBJECT_ALIGNMENT,
<a name="l00627"></a>00627         <span class="keyword">template</span> &lt;<span class="keyword">class</span>&gt; <span class="keyword">class </span>LifetimePolicy = LOKI_DEFAULT_SMALLOBJ_LIFETIME,
<a name="l00628"></a>00628         <span class="keyword">class </span>MutexPolicy = LOKI_DEFAULT_MUTEX
<a name="l00629"></a>00629     &gt;
<a name="l00630"></a><a class="code" href="a00527.html">00630</a>     <span class="keyword">class </span><a class="code" href="a00527.html">SmallValueObject</a> : <span class="keyword">public</span> <a class="code" href="a00526.html">SmallObjectBase</a>&lt; ThreadingModel, chunkSize,
<a name="l00631"></a>00631             maxSmallObjectSize, objectAlignSize, LifetimePolicy, MutexPolicy &gt;
<a name="l00632"></a>00632     {
<a name="l00633"></a>00633     <span class="keyword">protected</span>:
<a name="l00634"></a><a class="code" href="a00527.html#5cbe81d5f6568152f262f79f3ceb43f7">00634</a>         <span class="keyword">inline</span> <a class="code" href="a00527.html#5cbe81d5f6568152f262f79f3ceb43f7">SmallValueObject</a>( <span class="keywordtype">void</span> ) {}
<a name="l00635"></a><a class="code" href="a00527.html#e446be83fd90d9369b557a90b2d6f4e5">00635</a>         <span class="keyword">inline</span> <a class="code" href="a00527.html#5cbe81d5f6568152f262f79f3ceb43f7">SmallValueObject</a>( <span class="keyword">const</span> <a class="code" href="a00527.html">SmallValueObject</a> &amp; ) {}
<a name="l00636"></a><a class="code" href="a00527.html#9cca2d34447dd4ebc4a885cb04f113e4">00636</a>         <span class="keyword">inline</span> <a class="code" href="a00527.html">SmallValueObject</a> &amp; <a class="code" href="a00527.html#9cca2d34447dd4ebc4a885cb04f113e4">operator = </a>( <span class="keyword">const</span> <a class="code" href="a00527.html">SmallValueObject</a> &amp; )
<a name="l00637"></a>00637         { <span class="keywordflow">return</span> *<span class="keyword">this</span>; }
<a name="l00638"></a><a class="code" href="a00527.html#d5ed08013bbbe3639fe02a984ebbe90a">00638</a>         <span class="keyword">inline</span> <a class="code" href="a00527.html#d5ed08013bbbe3639fe02a984ebbe90a">~SmallValueObject</a>() {}
<a name="l00639"></a>00639     }; <span class="comment">// end class SmallValueObject</span>
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 } <span class="comment">// namespace Loki</span>
<a name="l00642"></a>00642 
<a name="l00643"></a>00643 <span class="preprocessor">#endif // end file guardian</span>
<a name="l00644"></a>00644 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Feb 25 16:52:27 2007 for Loki by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
